--------------------------------------------------------------------------------------------------------------------------
-- sha2.lua
--------------------------------------------------------------------------------------------------------------------------
-- VERSION: 12 (2022-02-23)
-- AUTHOR:  Egor Skriptunoff
-- LICENSE: MIT (the same license as Lua itself)
-- URL:     https://github.com/Egor-Skriptunoff/pure_lua_SHA
--
-- WARNING
--
-- THIS COPY OF sha2.lua IS MODIFIED FOR NEETCOMPUTERS. IT CONTAINS blake2b-512 AND NOTHING ELSE. IT HAS BEEN STRIPPED AND MINIFIED.
--
-- DESCRIPTION:
--    This module contains functions to calculate SHA digest:
--       MD5, SHA-1,
--       SHA-224, SHA-256, SHA-512/224, SHA-512/256, SHA-384, SHA-512,
--       SHA3-224, SHA3-256, SHA3-384, SHA3-512, SHAKE128, SHAKE256,
--       HMAC,
--       BLAKE2b, BLAKE2s, BLAKE2bp, BLAKE2sp, BLAKE2Xb, BLAKE2Xs,
--       BLAKE3, BLAKE3_KDF
--    Written in pure Lua.
--    Compatible with:
--       Lua 5.1, Lua 5.2, Lua 5.3, Lua 5.4, Fengari, LuaJIT 2.0/2.1 (any CPU endianness).
--    Main feature of this module: it was heavily optimized for speed.
--    For every Lua version the module contains particular implementation branch to get benefits from version-specific features.
--       - branch for Lua 5.1 (emulating bitwise operators using look-up table)
--       - branch for Lua 5.2 (using bit32/bit library), suitable for both Lua 5.2 with native "bit32" and Lua 5.1 with external library "bit"
--       - branch for Lua 5.3/5.4 (using native 64-bit bitwise operators)
--       - branch for Lua 5.3/5.4 (using native 32-bit bitwise operators) for Lua built with LUA_INT_TYPE=LUA_INT_INT
--       - branch for LuaJIT without FFI library (useful in a sandboxed environment)
--       - branch for LuaJIT x86 without FFI library (LuaJIT x86 has oddity because of lack of CPU registers)
--       - branch for LuaJIT 2.0 with FFI library (bit.* functions work only with Lua numbers)
--       - branch for LuaJIT 2.1 with FFI library (bit.* functions can work with "int64_t" arguments)
--
--
-- USAGE:
--    Input data should be provided as a binary string: either as a whole string or as a sequence of substrings (chunk-by-chunk loading, total length < 9*10^15 bytes).
--    Result (SHA digest) is returned in hexadecimal representation as a string of lowercase hex digits.
--    Simplest usage example:
--       local sha = require("sha2")
--       local your_hash = sha.sha256("your string")
--    See file "sha2_test.lua" for more examples.
--
--
-- CHANGELOG:
--  version     date      description
--  -------  ----------   -----------
--    12     2022-02-23   Now works in Luau (but NOT optimized for speed)
--    11     2022-01-09   BLAKE3 added
--    10     2022-01-02   BLAKE2 functions added
--     9     2020-05-10   Now works in OpenWrt's Lua (dialect of Lua 5.1 with "double" + "invisible int32")
--     8     2019-09-03   SHA-3 functions added
--     7     2019-03-17   Added functions to convert to/from base64
--     6     2018-11-12   HMAC added
--     5     2018-11-10   SHA-1 added
--     4     2018-11-03   MD5 added
--     3     2018-11-02   Bug fixed: incorrect hashing of long (2 GByte) data streams on Lua 5.3/5.4 built with "int32" integers
--     2     2018-10-07   Decreased module loading time in Lua 5.1 implementation branch (thanks to Peter Melnichenko for giving a hint)
--     1     2018-10-06   First release (only SHA-2 functions)
-----------------------------------------------------------------------------


local a=true;local unpack,b,c,d,e,f,g,h,i,j,k,l,tonumber,type,m=table.unpack or unpack,table.concat,string.byte,string.char,string.rep,string.sub,string.gsub,string.format,math.floor,math.ceil,math.min,math.max,tonumber,type,math.huge;local function n(o)local p,q,r,s=0,o,o;while true do p,s,q,r=p+1,q,q+q+1,r+r+p%2;if p>256 or q-(q-1)~=1 or r-(r-1)~=1 or q==r then return p,false elseif q==s then return p,true end end end;local t=2/3;local u=t*5>3 and t*4<3 and n(1.0)>=53;assert(u,"at least 53-bit floating point numbers are required")local v,w=n(1)local x=w and v==64;local y=w and v==32;assert(x or y or not w,"Lua integers must be either 32-bit or 64-bit")local z=({false,[1]=true})[1]and _VERSION~="Luau"and(type(jit)~="table"or jit.version_num>=20000)local A;local B;local C;local D;local E;if z then D=require"bit"E="bit"local F,G=pcall(require,"ffi")if F then C=G end;A=not not loadstring"b=0b0"B=type(jit)=="table"and jit.arch or C and C.arch or nil else for H,I in ipairs(_VERSION=="Lua 5.2"and{"bit32","bit"}or{"bit","bit32"})do if type(_G[I])=="table"and _G[I].bxor then D=_G[I]E=I;break end end end;if a then print("Abilities:")print("   Integer bitwise operators: "..(x and"int64"or y and"int32"or"no"))print("   32-bit bitwise library:    "..(E or"not found"))end;local J,K;if z and C then J="Using 'ffi' library of LuaJIT"K="FFI"elseif z then J="Using special code for sandboxed LuaJIT (no FFI)"K="LJ"elseif x then J="Using native int64 bitwise operators"K="INT64"elseif y then J="Using native int32 bitwise operators"K="INT32"elseif E then J="Using '"..E.."' library"K="LIB32"else J="Emulating bitwise operators using look-up table"K="EMUL"end;if a then print("Implementation selected:")print("   "..J)end;local L,M,N,O,P,Q,R,S,T,U,V;if K=="FFI"or K=="LJ"or K=="LIB32"then L=D.band;M=D.bor;N=D.bxor;O=D.lshift;P=D.rshift;Q=D.rol or D.lrotate;R=D.ror or D.rrotate;S=D.bnot;T=D.tobit;U=D.tohex;assert(L and M and N and O and P and Q and R and S,"Library '"..E.."' is incomplete")V=N elseif K=="EMUL"then function O(t,q)return t*2^q%2^32 end;function P(t,q)t=t%2^32/2^q;return t-t%1 end;function Q(t,q)t=t%2^32*2^q;local W=t%2^32;return W+(t-W)/2^32 end;function R(t,q)t=t%2^32/2^q;local W=t%1;return W*2^32+t-W end;local X={[0]=0}local Y=0;for Z=0,127*256,256 do for t=Z,Z+127 do t=X[t]*2;X[Y]=t;X[Y+1]=t;X[Y+256]=t;X[Y+257]=t+1;Y=Y+2 end;Y=Y+256 end;local function _(t,Z,a0)local a1=t%2^32;local a2=Z%2^32;local a3=a1%256;local a4=a2%256;local a5=X[a3+a4*256]t=a1-a3;Z=(a2-a4)/256;a3=t%65536;a4=Z%256;a5=a5+X[a3+a4]*256;t=(t-a3)/256;Z=(Z-a4)/256;a3=t%65536+Z%256;a5=a5+X[a3]*65536;a5=a5+X[(t+Z-a3)/256]*16777216;if a0 then a5=a1+a2-a0*a5 end;return a5 end;function L(t,Z)return _(t,Z)end;function M(t,Z)return _(t,Z,1)end;function N(t,Z,a6,a7,a8)if a6 then if a7 then if a8 then a7=_(a7,a8,2)end;a6=_(a6,a7,2)end;Z=_(Z,a6,2)end;return _(t,Z,2)end;function V(t,Z)return t+Z-2*X[t+Z*256]end end;U=U or pcall(h,"%x",2^31)and function(t)return h("%08x",t%4294967296)end or function(t)return h("%08x",(t+2^31)%2^32-2^31)end;local function a9(t,Z)return N(t,Z or 0xA5A5A5A5)%4294967296 end;local aa,ab,ac,ad,ae,af,ag,ah;local ai,aj,ak,al,am,an={},{},{},{},{},{}local ao={[224]={},[256]=al}local ap,aq={[384]={},[512]=ak},{[384]={},[512]=al}local ar,as={},{0x67452301,0xEFCDAB89,0x98BADCFE,0x10325476,0xC3D2E1F0}local at={0,0,0,0,0,0,0,0,28,25,26,27,0,0,10,9,11,12,0,15,16,17,18,0,20,22,23,21}local au,av;local aw={}local ax,ay,az=aw,aw,{}local aA,aB,aC=4294967296,0,0;local aD={{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16},{15,11,5,9,10,16,14,7,2,13,1,3,12,8,6,4},{12,9,13,1,6,3,16,14,11,15,4,7,8,2,10,5},{8,10,4,2,14,13,12,15,3,7,6,11,5,1,16,9},{10,1,6,8,3,5,11,16,15,2,12,13,7,9,4,14},{3,13,7,11,1,12,9,4,5,14,8,6,16,15,2,10},{13,6,2,16,15,14,5,11,1,8,7,4,10,3,9,12},{14,12,8,15,13,2,4,10,6,1,16,5,9,7,3,11},{7,16,15,10,12,4,1,9,13,3,14,8,2,5,11,6},{11,3,9,5,8,7,2,6,16,12,10,15,4,13,14,1}}aD[11],aD[12]=aD[1],aD[2]local aE={1,3,4,11,13,10,12,6,1,3,4,11,13,10,2,7,5,8,14,15,16,9,2,7,5,8,14,15}if K=="FFI"then local aF=C.new("int32_t[?]",80)ay=aF;az=C.new("int32_t[?]",16)aE=C.new("uint8_t[?]",#aE+1,0,unpack(aE))for aG=1,10 do aD[aG]=C.new("uint8_t[?]",#aD[aG]+1,0,unpack(aD[aG]))end;aD[11],aD[12]=aD[1],aD[2]local aH=C.new("int64_t[?]",80)ax=aH;local aI=C.typeof"int64_t"local aJ=C.typeof"int32_t"local aK=C.typeof"uint32_t"aB=aI(2^32)if A then local aL,aM,aN,aO,aP,aQ,aR,aS=L,M,N,S,O,P,Q,R;au=U;do local aT=C.new("int64_t[?]",16)local aU=ax;local function aV(aW,D,aX,aY,aZ,a_)local b0,b1,b2,b3=aT[aW],aT[D],aT[aX],aT[aY]b0=aU[aZ]+b0+b1;b3=aS(aN(b3,b0),32)b2=b2+b3;b1=aS(aN(b1,b2),24)b0=aU[a_]+b0+b1;b3=aS(aN(b3,b0),16)b2=b2+b3;b1=aR(aN(b1,b2),1)aT[aW],aT[D],aT[aX],aT[aY]=b0,b1,b2,b3 end;function ag(b4,H,b5,b6,b7,b8,b9,ba)local bb,bc,bd,be,bf,bg,bh,bi=b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]for bj=b6,b6+b7-1,128 do if b5 then for aG=1,16 do bj=bj+8;local aW,D,aX,aY,bk,bl,bm,bn=c(b5,bj-7,bj)aU[aG]=aN(M(O(bn,24),O(bm,16),O(bl,8),bk)*aI(2^32),aK(aJ(M(O(aY,24),O(aX,16),O(D,8),aW))))end end;aT[0x0],aT[0x1],aT[0x2],aT[0x3],aT[0x4],aT[0x5],aT[0x6],aT[0x7]=bb,bc,bd,be,bf,bg,bh,bi;aT[0x8],aT[0x9],aT[0xA],aT[0xB],aT[0xD],aT[0xE],aT[0xF]=ak[1],ak[2],ak[3],ak[4],ak[6],ak[7],ak[8]b8=b8+(b9 or 128)aT[0xC]=aN(ak[5],b8)if b9 then aT[0xE]=aO(aT[0xE])end;if ba then aT[0xF]=aO(aT[0xF])end;for aG=1,12 do local bo=aD[aG]aV(0,4,8,12,bo[1],bo[2])aV(1,5,9,13,bo[3],bo[4])aV(2,6,10,14,bo[5],bo[6])aV(3,7,11,15,bo[7],bo[8])aV(0,5,10,15,bo[9],bo[10])aV(1,6,11,12,bo[11],bo[12])aV(2,7,8,13,bo[13],bo[14])aV(3,4,9,14,bo[15],bo[16])end;bb=aN(bb,aT[0x0],aT[0x8])bc=aN(bc,aT[0x1],aT[0x9])bd=aN(bd,aT[0x2],aT[0xA])be=aN(be,aT[0x3],aT[0xB])bf=aN(bf,aT[0x4],aT[0xC])bg=aN(bg,aT[0x5],aT[0xD])bh=aN(bh,aT[0x6],aT[0xE])bi=aN(bi,aT[0x7],aT[0xF])end;b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]=bb,bc,bd,be,bf,bg,bh,bi;return b8 end end;local bp=C.typeof"int64_t[?]"av=0;aC=aI(2^32)local bq=0xA5A5A5A5*aI(2^32+1)function a9(br,bs)return aN(br,bs or bq)end;function ab(b4,H,b5,b6,b7)local aU,bt=aH,ai;for bj=b6,b6+b7-1,128 do for aG=0,15 do bj=bj+8;local aW,D,aX,aY,bk,bl,bm,bn=c(b5,bj-7,bj)aU[aG]=aM(M(O(aW,24),O(D,16),O(aX,8),aY)*aI(2^32),aK(aJ(M(O(bk,24),O(bl,16),O(bm,8),bn))))end;for aG=16,79 do local aW,D=aU[aG-15],aU[aG-2]aU[aG]=aN(aS(aW,1),aS(aW,8),aQ(aW,7))+aN(aS(D,19),aR(D,3),aQ(D,6))+aU[aG-7]+aU[aG-16]end;local aW,D,aX,aY,bk,bl,bm,bn=b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]for aG=0,79,8 do local a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+1]+aU[aG]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+2]+aU[aG+1]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+3]+aU[aG+2]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+4]+aU[aG+3]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+5]+aU[aG+4]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+6]+aU[aG+5]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+7]+aU[aG+6]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6;a6=aN(aS(bk,14),aS(bk,18),aR(bk,23))+aN(bm,aL(bk,aN(bl,bm)))+bn+bt[aG+8]+aU[aG+7]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,aN(aL(aN(aW,D),aX),aL(aW,D))+aN(aS(aW,28),aR(aW,25),aR(aW,30))+a6 end;b4[1]=aW+b4[1]b4[2]=D+b4[2]b4[3]=aX+b4[3]b4[4]=aY+b4[4]b4[5]=bk+b4[5]b4[6]=bl+b4[6]b4[7]=bm+b4[7]b4[8]=bn+b4[8]end end else local bu=C.new("union{int64_t i64; struct{int32_t "..(C.abi("le")and"lo, hi"or"hi, lo")..";} i32;}[3]")local function bv(aW)bu[0].i64=aW;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local by=N(P(bw,1),O(bx,31),P(bw,8),O(bx,24),P(bw,7),O(bx,25))local bz=N(P(bx,1),O(bw,31),P(bx,8),O(bw,24),P(bx,7))return bz*aI(2^32)+aK(aJ(by))end;local function bA(D)bu[0].i64=D;local bB,bC=bu[0].i32.lo,bu[0].i32.hi;local bD=N(P(bB,19),O(bC,13),O(bB,3),P(bC,29),P(bB,6),O(bC,26))local bE=N(P(bC,19),O(bB,13),O(bC,3),P(bB,29),P(bC,6))return bE*aI(2^32)+aK(aJ(bD))end;local function bF(bk)bu[0].i64=bk;local bG,bH=bu[0].i32.lo,bu[0].i32.hi;local bD=N(P(bG,14),O(bH,18),P(bG,18),O(bH,14),O(bG,23),P(bH,9))local bE=N(P(bH,14),O(bG,18),P(bH,18),O(bG,14),O(bH,23),P(bG,9))return bE*aI(2^32)+aK(aJ(bD))end;local function bI(aW)bu[0].i64=aW;local bB,bC=bu[0].i32.lo,bu[0].i32.hi;local bD=N(P(bB,28),O(bC,4),O(bB,30),P(bC,2),O(bB,25),P(bC,7))local bE=N(P(bC,28),O(bB,4),O(bC,30),P(bB,2),O(bC,25),P(bB,7))return bE*aI(2^32)+aK(aJ(bD))end;local function bJ(bk,bl,bm)bu[0].i64=bl;bu[1].i64=bm;bu[2].i64=bk;local bK,bL=bu[0].i32.lo,bu[0].i32.hi;local bM,bN=bu[1].i32.lo,bu[1].i32.hi;local bG,bH=bu[2].i32.lo,bu[2].i32.hi;local bO=N(bM,L(bG,N(bK,bM)))local bP=N(bN,L(bH,N(bL,bN)))return bP*aI(2^32)+aK(aJ(bO))end;local function bQ(aW,D,aX)bu[0].i64=aW;bu[1].i64=D;bu[2].i64=aX;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local bR,bS=bu[2].i32.lo,bu[2].i32.hi;local bO=N(L(N(bw,bB),bR),L(bw,bB))local bP=N(L(N(bx,bC),bS),L(bx,bC))return bP*aI(2^32)+aK(aJ(bO))end;local function bT(aW,D,r)bu[0].i64=aW;bu[1].i64=D;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local bR,bS=N(bw,bB),N(bx,bC)local by=N(P(bR,r),O(bS,-r))local bz=N(P(bS,r),O(bR,-r))return bz*aI(2^32)+aK(aJ(by))end;local function bU(aW,D)bu[0].i64=aW;bu[1].i64=D;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local bR,bS=N(bw,bB),N(bx,bC)local by=N(O(bR,1),P(bS,31))local bz=N(O(bS,1),P(bR,31))return bz*aI(2^32)+aK(aJ(by))end;local function bV(aW,D)bu[0].i64=aW;bu[1].i64=D;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local bz,by=N(bw,bB),N(bx,bC)return bz*aI(2^32)+aK(aJ(by))end;local function aN(aW,D)bu[0].i64=aW;bu[1].i64=D;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local by,bz=N(bw,bB),N(bx,bC)return bz*aI(2^32)+aK(aJ(by))end;local function bW(aW,D,aX)bu[0].i64=aW;bu[1].i64=D;bu[2].i64=aX;local bw,bx=bu[0].i32.lo,bu[0].i32.hi;local bB,bC=bu[1].i32.lo,bu[1].i32.hi;local bR,bS=bu[2].i32.lo,bu[2].i32.hi;local by,bz=N(bw,bB,bR),N(bx,bC,bS)return bz*aI(2^32)+aK(aJ(by))end;function a9(br,bs)bu[0].i64=br;local bX,bY=bu[0].i32.lo,bu[0].i32.hi;local bZ,b_=0xA5A5A5A5,0xA5A5A5A5;if bs then bu[1].i64=bs;bZ,b_=bu[1].i32.lo,bu[1].i32.hi end;bX=N(bX,bZ)bY=N(bY,b_)return bY*aI(2^32)+aK(aJ(bX))end;function au(br)bu[0].i64=br;return U(bu[0].i32.hi)..U(bu[0].i32.lo)end;function ab(b4,H,b5,b6,b7)local aU,bt=aH,ai;for bj=b6,b6+b7-1,128 do for aG=0,15 do bj=bj+8;local aW,D,aX,aY,bk,bl,bm,bn=c(b5,bj-7,bj)aU[aG]=M(O(aW,24),O(D,16),O(aX,8),aY)*aI(2^32)+aK(aJ(M(O(bk,24),O(bl,16),O(bm,8),bn)))end;for aG=16,79 do aU[aG]=bv(aU[aG-15])+bA(aU[aG-2])+aU[aG-7]+aU[aG-16]end;local aW,D,aX,aY,bk,bl,bm,bn=b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]for aG=0,79,8 do local a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+1]+aU[aG]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+2]+aU[aG+1]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+3]+aU[aG+2]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+4]+aU[aG+3]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+5]+aU[aG+4]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+6]+aU[aG+5]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+7]+aU[aG+6]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6;a6=bF(bk)+bJ(bk,bl,bm)+bn+bt[aG+8]+aU[aG+7]bn,bm,bl,bk=bm,bl,bk,a6+aY;aY,aX,D,aW=aX,D,aW,bQ(aW,D,aX)+bI(aW)+a6 end;b4[1]=aW+b4[1]b4[2]=D+b4[2]b4[3]=aX+b4[3]b4[4]=aY+b4[4]b4[5]=bk+b4[5]b4[6]=bl+b4[6]b4[7]=bm+b4[7]b4[8]=bn+b4[8]end end;do local aT=C.new("int64_t[?]",16)local aU=ax;local function aV(aW,D,aX,aY,aZ,a_)local b0,b1,b2,b3=aT[aW],aT[D],aT[aX],aT[aY]b0=aU[aZ]+b0+b1;b3=bV(b3,b0)b2=b2+b3;b1=bT(b1,b2,24)b0=aU[a_]+b0+b1;b3=bT(b3,b0,16)b2=b2+b3;b1=bU(b1,b2)aT[aW],aT[D],aT[aX],aT[aY]=b0,b1,b2,b3 end;function ag(b4,H,b5,b6,b7,b8,b9,ba)local bb,bc,bd,be,bf,bg,bh,bi=b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]for bj=b6,b6+b7-1,128 do if b5 then for aG=1,16 do bj=bj+8;local aW,D,aX,aY,bk,bl,bm,bn=c(b5,bj-7,bj)aU[aG]=aN(M(O(bn,24),O(bm,16),O(bl,8),bk)*aI(2^32),aK(aJ(M(O(aY,24),O(aX,16),O(D,8),aW))))end end;aT[0x0],aT[0x1],aT[0x2],aT[0x3],aT[0x4],aT[0x5],aT[0x6],aT[0x7]=bb,bc,bd,be,bf,bg,bh,bi;aT[0x8],aT[0x9],aT[0xA],aT[0xB],aT[0xD],aT[0xE],aT[0xF]=ak[1],ak[2],ak[3],ak[4],ak[6],ak[7],ak[8]b8=b8+(b9 or 128)aT[0xC]=aN(ak[5],b8)if b9 then aT[0xE]=-1-aT[0xE]end;if ba then aT[0xF]=-1-aT[0xF]end;for aG=1,12 do local bo=aD[aG]aV(0,4,8,12,bo[1],bo[2])aV(1,5,9,13,bo[3],bo[4])aV(2,6,10,14,bo[5],bo[6])aV(3,7,11,15,bo[7],bo[8])aV(0,5,10,15,bo[9],bo[10])aV(1,6,11,12,bo[11],bo[12])aV(2,7,8,13,bo[13],bo[14])aV(3,4,9,14,bo[15],bo[16])end;bb=bW(bb,aT[0x0],aT[0x8])bc=bW(bc,aT[0x1],aT[0x9])bd=bW(bd,aT[0x2],aT[0xA])be=bW(be,aT[0x3],aT[0xB])bf=bW(bf,aT[0x4],aT[0xC])bg=bW(bg,aT[0x5],aT[0xD])bh=bW(bh,aT[0x6],aT[0xE])bi=bW(bi,aT[0x7],aT[0xF])end;b4[1],b4[2],b4[3],b4[4],b4[5],b4[6],b4[7],b4[8]=bb,bc,bd,be,bf,bg,bh,bi;return b8 end end end end;if K=="LJ"then local function c0(bw,bx,bB,bC,bR,bS,c1,c2)local c3=bw%2^32+bB%2^32+bR%2^32+c1%2^32;local c4=bx+bC+bS+c2;local bO=T(c3)local bP=T(c4+i(c3/2^32))return bO,bP end;if B=="x86"then function ab(c5,c6,b5,b6,b7)local aU,c7,c8=aw,ai,aj;for bj=b6,b6+b7-1,128 do for aG=1,16*2 do bj=bj+4;local aW,D,aX,aY=c(b5,bj-3,bj)aU[aG]=M(O(aW,24),O(D,16),O(aX,8),aY)end;for c9=17*2,80*2,2 do local bw,bx=aU[c9-30],aU[c9-31]local by=N(M(P(bw,1),O(bx,31)),M(P(bw,8),O(bx,24)),M(P(bw,7),O(bx,25)))local bz=N(M(P(bx,1),O(bw,31)),M(P(bx,8),O(bw,24)),P(bx,7))local bB,bC=aU[c9-4],aU[c9-5]local bD=N(M(P(bB,19),O(bC,13)),M(O(bB,3),P(bC,29)),M(P(bB,6),O(bC,26)))local bE=N(M(P(bC,19),O(bB,13)),M(O(bC,3),P(bB,29)),P(bC,6))aU[c9],aU[c9-1]=c0(by,bz,bD,bE,aU[c9-14],aU[c9-15],aU[c9-32],aU[c9-33])end;local bw,bB,bR,c1,bG,bK,bM,ca=c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]local bx,bC,bS,c2,bH,bL,bN,cb=c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]local cc=0;for aG=1,80 do local by=N(bM,L(bG,N(bK,bM)))local bz=N(bN,L(bH,N(bL,bN)))local bD=N(M(P(bG,14),O(bH,18)),M(P(bG,18),O(bH,14)),M(O(bG,23),P(bH,9)))local bE=N(M(P(bH,14),O(bG,18)),M(P(bH,18),O(bG,14)),M(O(bH,23),P(bG,9)))local c3=bD%2^32+by%2^32+ca%2^32+c7[aG]+aU[2*aG]%2^32;local cd,ce=T(c3),T(bE+bz+cb+c8[aG]+aU[2*aG-1]+i(c3/2^32))cc=cc+cc;ca,cb,bM,bN,bK,bL=M(cc,bM),M(cc,bN),M(cc,bK),M(cc,bL),M(cc,bG),M(cc,bH)local c3=cd%2^32+c1%2^32;bG,bH=T(c3),T(ce+c2+i(c3/2^32))c1,c2,bR,bS,bB,bC=M(cc,bR),M(cc,bS),M(cc,bB),M(cc,bC),M(cc,bw),M(cc,bx)bD=N(M(P(bB,28),O(bC,4)),M(O(bB,30),P(bC,2)),M(O(bB,25),P(bC,7)))bE=N(M(P(bC,28),O(bB,4)),M(O(bC,30),P(bB,2)),M(O(bC,25),P(bB,7)))by=M(L(c1,bR),L(bB,N(c1,bR)))bz=M(L(c2,bS),L(bC,N(c2,bS)))local c3=cd%2^32+by%2^32+bD%2^32;bw,bx=T(c3),T(ce+bz+bE+i(c3/2^32))end;c5[1],c6[1]=c0(c5[1],c6[1],bw,bx,0,0,0,0)c5[2],c6[2]=c0(c5[2],c6[2],bB,bC,0,0,0,0)c5[3],c6[3]=c0(c5[3],c6[3],bR,bS,0,0,0,0)c5[4],c6[4]=c0(c5[4],c6[4],c1,c2,0,0,0,0)c5[5],c6[5]=c0(c5[5],c6[5],bG,bH,0,0,0,0)c5[6],c6[6]=c0(c5[6],c6[6],bK,bL,0,0,0,0)c5[7],c6[7]=c0(c5[7],c6[7],bM,bN,0,0,0,0)c5[8],c6[8]=c0(c5[8],c6[8],ca,cb,0,0,0,0)end end else function ab(c5,c6,b5,b6,b7)local aU,c7,c8=aw,ai,aj;for bj=b6,b6+b7-1,128 do for aG=1,16*2 do bj=bj+4;local aW,D,aX,aY=c(b5,bj-3,bj)aU[aG]=M(O(aW,24),O(D,16),O(aX,8),aY)end;for c9=17*2,80*2,2 do local bw,bx=aU[c9-30],aU[c9-31]local by=N(M(P(bw,1),O(bx,31)),M(P(bw,8),O(bx,24)),M(P(bw,7),O(bx,25)))local bz=N(M(P(bx,1),O(bw,31)),M(P(bx,8),O(bw,24)),P(bx,7))local bB,bC=aU[c9-4],aU[c9-5]local bD=N(M(P(bB,19),O(bC,13)),M(O(bB,3),P(bC,29)),M(P(bB,6),O(bC,26)))local bE=N(M(P(bC,19),O(bB,13)),M(O(bC,3),P(bB,29)),P(bC,6))aU[c9],aU[c9-1]=c0(by,bz,bD,bE,aU[c9-14],aU[c9-15],aU[c9-32],aU[c9-33])end;local bw,bB,bR,c1,bG,bK,bM,ca=c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]local bx,bC,bS,c2,bH,bL,bN,cb=c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]for aG=1,80 do local by=N(bM,L(bG,N(bK,bM)))local bz=N(bN,L(bH,N(bL,bN)))local bD=N(M(P(bG,14),O(bH,18)),M(P(bG,18),O(bH,14)),M(O(bG,23),P(bH,9)))local bE=N(M(P(bH,14),O(bG,18)),M(P(bH,18),O(bG,14)),M(O(bH,23),P(bG,9)))local c3=bD%2^32+by%2^32+ca%2^32+c7[aG]+aU[2*aG]%2^32;local cd,ce=T(c3),T(bE+bz+cb+c8[aG]+aU[2*aG-1]+i(c3/2^32))ca,cb,bM,bN,bK,bL=bM,bN,bK,bL,bG,bH;local c3=cd%2^32+c1%2^32;bG,bH=T(c3),T(ce+c2+i(c3/2^32))c1,c2,bR,bS,bB,bC=bR,bS,bB,bC,bw,bx;bD=N(M(P(bB,28),O(bC,4)),M(O(bB,30),P(bC,2)),M(O(bB,25),P(bC,7)))bE=N(M(P(bC,28),O(bB,4)),M(O(bC,30),P(bB,2)),M(O(bC,25),P(bB,7)))by=M(L(c1,bR),L(bB,N(c1,bR)))bz=M(L(c2,bS),L(bC,N(c2,bS)))local c3=cd%2^32+bD%2^32+by%2^32;bw,bx=T(c3),T(ce+bE+bz+i(c3/2^32))end;c5[1],c6[1]=c0(c5[1],c6[1],bw,bx,0,0,0,0)c5[2],c6[2]=c0(c5[2],c6[2],bB,bC,0,0,0,0)c5[3],c6[3]=c0(c5[3],c6[3],bR,bS,0,0,0,0)c5[4],c6[4]=c0(c5[4],c6[4],c1,c2,0,0,0,0)c5[5],c6[5]=c0(c5[5],c6[5],bG,bH,0,0,0,0)c5[6],c6[6]=c0(c5[6],c6[6],bK,bL,0,0,0,0)c5[7],c6[7]=c0(c5[7],c6[7],bM,bN,0,0,0,0)c5[8],c6[8]=c0(c5[8],c6[8],ca,cb,0,0,0,0)end end end;do local cf,cg={},{}local function aV(aW,D,aX,aY,aZ,a_)local aU=aw;local ch,ci,cj,ck=cf[aW],cf[D],cf[aX],cf[aY]local cl,cm,cn,co=cg[aW],cg[D],cg[aX],cg[aY]local a6=aU[2*aZ-1]+ch%2^32+ci%2^32;ch=T(a6)cl=T(aU[2*aZ]+cl+cm+i(a6/2^32))ck,co=N(co,cl),N(ck,ch)a6=cj%2^32+ck%2^32;cj=T(a6)cn=T(cn+co+i(a6/2^32))ci,cm=N(ci,cj),N(cm,cn)ci,cm=N(P(ci,24),O(cm,8)),N(P(cm,24),O(ci,8))a6=aU[2*a_-1]+ch%2^32+ci%2^32;ch=T(a6)cl=T(aU[2*a_]+cl+cm+i(a6/2^32))ck,co=N(ck,ch),N(co,cl)ck,co=N(P(ck,16),O(co,16)),N(P(co,16),O(ck,16))a6=cj%2^32+ck%2^32;cj=T(a6)cn=T(cn+co+i(a6/2^32))ci,cm=N(ci,cj),N(cm,cn)ci,cm=N(O(ci,1),P(cm,31)),N(O(cm,1),P(ci,31))cf[aW],cf[D],cf[aX],cf[aY]=ch,ci,cj,ck;cg[aW],cg[D],cg[aX],cg[aY]=cl,cm,cn,co end;function ag(c5,c6,b5,b6,b7,b8,b9,ba)local aU=aw;local cp,cq,cr,cs,ct,cu,cv,cw=c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]local cx,cy,cz,cA,cB,cC,cD,cE=c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]for bj=b6,b6+b7-1,128 do if b5 then for aG=1,32 do bj=bj+4;local aW,D,aX,aY=c(b5,bj-3,bj)aU[aG]=aY*2^24+M(O(aX,16),O(D,8),aW)end end;cf[0x0],cf[0x1],cf[0x2],cf[0x3],cf[0x4],cf[0x5],cf[0x6],cf[0x7]=cp,cq,cr,cs,ct,cu,cv,cw;cf[0x8],cf[0x9],cf[0xA],cf[0xB],cf[0xC],cf[0xD],cf[0xE],cf[0xF]=ak[1],ak[2],ak[3],ak[4],ak[5],ak[6],ak[7],ak[8]cg[0x0],cg[0x1],cg[0x2],cg[0x3],cg[0x4],cg[0x5],cg[0x6],cg[0x7]=cx,cy,cz,cA,cB,cC,cD,cE;cg[0x8],cg[0x9],cg[0xA],cg[0xB],cg[0xC],cg[0xD],cg[0xE],cg[0xF]=al[1],al[2],al[3],al[4],al[5],al[6],al[7],al[8]b8=b8+(b9 or 128)local cF=b8%2^32;local cG=i(b8/2^32)cf[0xC]=N(cf[0xC],cF)cg[0xC]=N(cg[0xC],cG)if b9 then cf[0xE]=S(cf[0xE])cg[0xE]=S(cg[0xE])end;if ba then cf[0xF]=S(cf[0xF])cg[0xF]=S(cg[0xF])end;for aG=1,12 do local bo=aD[aG]aV(0,4,8,12,bo[1],bo[2])aV(1,5,9,13,bo[3],bo[4])aV(2,6,10,14,bo[5],bo[6])aV(3,7,11,15,bo[7],bo[8])aV(0,5,10,15,bo[9],bo[10])aV(1,6,11,12,bo[11],bo[12])aV(2,7,8,13,bo[13],bo[14])aV(3,4,9,14,bo[15],bo[16])end;cp=N(cp,cf[0x0],cf[0x8])cq=N(cq,cf[0x1],cf[0x9])cr=N(cr,cf[0x2],cf[0xA])cs=N(cs,cf[0x3],cf[0xB])ct=N(ct,cf[0x4],cf[0xC])cu=N(cu,cf[0x5],cf[0xD])cv=N(cv,cf[0x6],cf[0xE])cw=N(cw,cf[0x7],cf[0xF])cx=N(cx,cg[0x0],cg[0x8])cy=N(cy,cg[0x1],cg[0x9])cz=N(cz,cg[0x2],cg[0xA])cA=N(cA,cg[0x3],cg[0xB])cB=N(cB,cg[0x4],cg[0xC])cC=N(cC,cg[0x5],cg[0xD])cD=N(cD,cg[0x6],cg[0xE])cE=N(cE,cg[0x7],cg[0xF])end;c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]=cp%2^32,cq%2^32,cr%2^32,cs%2^32,ct%2^32,cu%2^32,cv%2^32,cw%2^32;c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]=cx%2^32,cy%2^32,cz%2^32,cA%2^32,cB%2^32,cC%2^32,cD%2^32,cE%2^32;return b8 end end end;N=N or a9;if K=="LIB32"or K=="EMUL"then function ab(c5,c6,b5,b6,b7)local aU,c7,c8=aw,ai,aj;local cp,cq,cr,cs,ct,cu,cv,cw=c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]local cx,cy,cz,cA,cB,cC,cD,cE=c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]for bj=b6,b6+b7-1,128 do for aG=1,16*2 do bj=bj+4;local aW,D,aX,aY=c(b5,bj-3,bj)aU[aG]=((aW*256+D)*256+aX)*256+aY end;for c9=17*2,80*2,2 do local bx,bw,bC,bB=aU[c9-31],aU[c9-30],aU[c9-5],aU[c9-4]local cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ=bC%2^6,bC%2^19,bC%2^29,bB%2^19,bB%2^29,bx%2^1,bx%2^7,bx%2^8,bw%2^1,bw%2^8;local cR=N((bw-cP)/2^1+cM*2^31,(bw-cQ)/2^8+cO*2^24,(bw-bw%2^7)/2^7+cN*2^25)%2^32+N((bB-cK)/2^19+cI*2^13,cL*2^3+(bC-cJ)/2^29,(bB-bB%2^6)/2^6+cH*2^26)%2^32+aU[c9-14]+aU[c9-32]local cS=cR%2^32;aU[c9-1]=(N((bx-cM)/2^1+cP*2^31,(bx-cO)/2^8+cQ*2^24,(bx-cN)/2^7)+N((bC-cI)/2^19+cK*2^13,cJ*2^3+(bB-cL)/2^29,(bC-cH)/2^6)+aU[c9-15]+aU[c9-33]+(cR-cS)/2^32)%2^32;aU[c9]=cS end;local bw,bB,bR,c1,bG,bK,bM,ca=cp,cq,cr,cs,ct,cu,cv,cw;local bx,bC,bS,c2,bH,bL,bN,cb=cx,cy,cz,cA,cB,cC,cD,cE;for aG=1,80 do local c9=2*aG;local cT,cU,cV,cW,cX,cY=bG%2^9,bG%2^14,bG%2^18,bH%2^9,bH%2^14,bH%2^18;local cR=(L(bG,bK)+L(-1-bG,bM))%2^32+ca+c7[aG]+aU[c9]+N((bG-cU)/2^14+cX*2^18,(bG-cV)/2^18+cY*2^14,cT*2^23+(bH-cW)/2^9)%2^32;local cd=cR%2^32;local ce=L(bH,bL)+L(-1-bH,bN)+cb+c8[aG]+aU[c9-1]+(cR-cd)/2^32+N((bH-cX)/2^14+cU*2^18,(bH-cY)/2^18+cV*2^14,cW*2^23+(bG-cT)/2^9)ca=bM;cb=bN;bM=bK;bN=bL;bK=bG;bL=bH;cR=cd+c1;bG=cR%2^32;bH=(ce+c2+(cR-bG)/2^32)%2^32;c1=bR;c2=bS;bR=bB;bS=bC;bB=bw;bC=bx;local cZ,c_,d0,d1,d2,d3=bB%2^2,bB%2^7,bB%2^28,bC%2^2,bC%2^7,bC%2^28;cR=cd+(L(c1,bR)+L(bB,N(c1,bR)))%2^32+N((bB-d0)/2^28+d3*2^4,cZ*2^30+(bC-d1)/2^2,c_*2^25+(bC-d2)/2^7)%2^32;bw=cR%2^32;bx=(ce+L(c2,bS)+L(bC,N(c2,bS))+(cR-bw)/2^32+N((bC-d3)/2^28+d0*2^4,d1*2^30+(bB-cZ)/2^2,d2*2^25+(bB-c_)/2^7))%2^32 end;bw=cp+bw;cp=bw%2^32;cx=(cx+bx+(bw-cp)/2^32)%2^32;bw=cq+bB;cq=bw%2^32;cy=(cy+bC+(bw-cq)/2^32)%2^32;bw=cr+bR;cr=bw%2^32;cz=(cz+bS+(bw-cr)/2^32)%2^32;bw=cs+c1;cs=bw%2^32;cA=(cA+c2+(bw-cs)/2^32)%2^32;bw=ct+bG;ct=bw%2^32;cB=(cB+bH+(bw-ct)/2^32)%2^32;bw=cu+bK;cu=bw%2^32;cC=(cC+bL+(bw-cu)/2^32)%2^32;bw=cv+bM;cv=bw%2^32;cD=(cD+bN+(bw-cv)/2^32)%2^32;bw=cw+ca;cw=bw%2^32;cE=(cE+cb+(bw-cw)/2^32)%2^32 end;c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]=cp,cq,cr,cs,ct,cu,cv,cw;c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]=cx,cy,cz,cA,cB,cC,cD,cE end;function ag(c5,c6,b5,b6,b7,b8,b9,ba)local aU=aw;local cp,cq,cr,cs,ct,cu,cv,cw=c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]local cx,cy,cz,cA,cB,cC,cD,cE=c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]for bj=b6,b6+b7-1,128 do if b5 then for aG=1,32 do bj=bj+4;local aW,D,aX,aY=c(b5,bj-3,bj)aU[aG]=((aY*256+aX)*256+D)*256+aW end end;local d4,d5,d6,d7,d8,d9,da,db=cp,cq,cr,cs,ct,cu,cv,cw;local dc,dd,de,df,dg,dh,di,dj=cx,cy,cz,cA,cB,cC,cD,cE;local dk,dl,dm,dn,dp,dq,dr,ds=ak[1],ak[2],ak[3],ak[4],ak[5],ak[6],ak[7],ak[8]local dt,du,dv,dw,dx,dy,dz,dA=al[1],al[2],al[3],al[4],al[5],al[6],al[7],al[8]b8=b8+(b9 or 128)local cF=b8%2^32;local cG=(b8-cF)/2^32;dp=N(dp,cF)dx=N(dx,cG)if b9 then dr=-1-dr;dz=-1-dz end;if ba then ds=-1-ds;dA=-1-dA end;for aG=1,12 do local bo=aD[aG]local p=bo[1]*2;local a6=d4%2^32+d8%2^32+aU[p-1]d4=a6%2^32;dc=dc+dg+(a6-d4)/2^32+aU[p]dp,dx=N(dx,dc),N(dp,d4)a6=dk%2^32+dp%2^32;dk=a6%2^32;dt=dt+dx+(a6-dk)/2^32;d8,dg=N(d8,dk),N(dg,dt)local cd,ce=d8%2^24,dg%2^24;d8,dg=(d8-cd)/2^24%2^8+ce*2^8,(dg-ce)/2^24%2^8+cd*2^8;p=bo[2]*2;a6=d4%2^32+d8%2^32+aU[p-1]d4=a6%2^32;dc=dc+dg+(a6-d4)/2^32+aU[p]dp,dx=N(dp,d4),N(dx,dc)cd,ce=dp%2^16,dx%2^16;dp,dx=(dp-cd)/2^16%2^16+ce*2^16,(dx-ce)/2^16%2^16+cd*2^16;a6=dk%2^32+dp%2^32;dk=a6%2^32;dt=dt+dx+(a6-dk)/2^32;d8,dg=N(d8,dk),N(dg,dt)cd,ce=d8%2^31,dg%2^31;d8,dg=cd*2^1+(dg-ce)/2^31%2^1,ce*2^1+(d8-cd)/2^31%2^1;p=bo[3]*2;a6=d5%2^32+d9%2^32+aU[p-1]d5=a6%2^32;dd=dd+dh+(a6-d5)/2^32+aU[p]dq,dy=N(dy,dd),N(dq,d5)a6=dl%2^32+dq%2^32;dl=a6%2^32;du=du+dy+(a6-dl)/2^32;d9,dh=N(d9,dl),N(dh,du)cd,ce=d9%2^24,dh%2^24;d9,dh=(d9-cd)/2^24%2^8+ce*2^8,(dh-ce)/2^24%2^8+cd*2^8;p=bo[4]*2;a6=d5%2^32+d9%2^32+aU[p-1]d5=a6%2^32;dd=dd+dh+(a6-d5)/2^32+aU[p]dq,dy=N(dq,d5),N(dy,dd)cd,ce=dq%2^16,dy%2^16;dq,dy=(dq-cd)/2^16%2^16+ce*2^16,(dy-ce)/2^16%2^16+cd*2^16;a6=dl%2^32+dq%2^32;dl=a6%2^32;du=du+dy+(a6-dl)/2^32;d9,dh=N(d9,dl),N(dh,du)cd,ce=d9%2^31,dh%2^31;d9,dh=cd*2^1+(dh-ce)/2^31%2^1,ce*2^1+(d9-cd)/2^31%2^1;p=bo[5]*2;a6=d6%2^32+da%2^32+aU[p-1]d6=a6%2^32;de=de+di+(a6-d6)/2^32+aU[p]dr,dz=N(dz,de),N(dr,d6)a6=dm%2^32+dr%2^32;dm=a6%2^32;dv=dv+dz+(a6-dm)/2^32;da,di=N(da,dm),N(di,dv)cd,ce=da%2^24,di%2^24;da,di=(da-cd)/2^24%2^8+ce*2^8,(di-ce)/2^24%2^8+cd*2^8;p=bo[6]*2;a6=d6%2^32+da%2^32+aU[p-1]d6=a6%2^32;de=de+di+(a6-d6)/2^32+aU[p]dr,dz=N(dr,d6),N(dz,de)cd,ce=dr%2^16,dz%2^16;dr,dz=(dr-cd)/2^16%2^16+ce*2^16,(dz-ce)/2^16%2^16+cd*2^16;a6=dm%2^32+dr%2^32;dm=a6%2^32;dv=dv+dz+(a6-dm)/2^32;da,di=N(da,dm),N(di,dv)cd,ce=da%2^31,di%2^31;da,di=cd*2^1+(di-ce)/2^31%2^1,ce*2^1+(da-cd)/2^31%2^1;p=bo[7]*2;a6=d7%2^32+db%2^32+aU[p-1]d7=a6%2^32;df=df+dj+(a6-d7)/2^32+aU[p]ds,dA=N(dA,df),N(ds,d7)a6=dn%2^32+ds%2^32;dn=a6%2^32;dw=dw+dA+(a6-dn)/2^32;db,dj=N(db,dn),N(dj,dw)cd,ce=db%2^24,dj%2^24;db,dj=(db-cd)/2^24%2^8+ce*2^8,(dj-ce)/2^24%2^8+cd*2^8;p=bo[8]*2;a6=d7%2^32+db%2^32+aU[p-1]d7=a6%2^32;df=df+dj+(a6-d7)/2^32+aU[p]ds,dA=N(ds,d7),N(dA,df)cd,ce=ds%2^16,dA%2^16;ds,dA=(ds-cd)/2^16%2^16+ce*2^16,(dA-ce)/2^16%2^16+cd*2^16;a6=dn%2^32+ds%2^32;dn=a6%2^32;dw=dw+dA+(a6-dn)/2^32;db,dj=N(db,dn),N(dj,dw)cd,ce=db%2^31,dj%2^31;db,dj=cd*2^1+(dj-ce)/2^31%2^1,ce*2^1+(db-cd)/2^31%2^1;p=bo[9]*2;a6=d4%2^32+d9%2^32+aU[p-1]d4=a6%2^32;dc=dc+dh+(a6-d4)/2^32+aU[p]ds,dA=N(dA,dc),N(ds,d4)a6=dm%2^32+ds%2^32;dm=a6%2^32;dv=dv+dA+(a6-dm)/2^32;d9,dh=N(d9,dm),N(dh,dv)cd,ce=d9%2^24,dh%2^24;d9,dh=(d9-cd)/2^24%2^8+ce*2^8,(dh-ce)/2^24%2^8+cd*2^8;p=bo[10]*2;a6=d4%2^32+d9%2^32+aU[p-1]d4=a6%2^32;dc=dc+dh+(a6-d4)/2^32+aU[p]ds,dA=N(ds,d4),N(dA,dc)cd,ce=ds%2^16,dA%2^16;ds,dA=(ds-cd)/2^16%2^16+ce*2^16,(dA-ce)/2^16%2^16+cd*2^16;a6=dm%2^32+ds%2^32;dm=a6%2^32;dv=dv+dA+(a6-dm)/2^32;d9,dh=N(d9,dm),N(dh,dv)cd,ce=d9%2^31,dh%2^31;d9,dh=cd*2^1+(dh-ce)/2^31%2^1,ce*2^1+(d9-cd)/2^31%2^1;p=bo[11]*2;a6=d5%2^32+da%2^32+aU[p-1]d5=a6%2^32;dd=dd+di+(a6-d5)/2^32+aU[p]dp,dx=N(dx,dd),N(dp,d5)a6=dn%2^32+dp%2^32;dn=a6%2^32;dw=dw+dx+(a6-dn)/2^32;da,di=N(da,dn),N(di,dw)cd,ce=da%2^24,di%2^24;da,di=(da-cd)/2^24%2^8+ce*2^8,(di-ce)/2^24%2^8+cd*2^8;p=bo[12]*2;a6=d5%2^32+da%2^32+aU[p-1]d5=a6%2^32;dd=dd+di+(a6-d5)/2^32+aU[p]dp,dx=N(dp,d5),N(dx,dd)cd,ce=dp%2^16,dx%2^16;dp,dx=(dp-cd)/2^16%2^16+ce*2^16,(dx-ce)/2^16%2^16+cd*2^16;a6=dn%2^32+dp%2^32;dn=a6%2^32;dw=dw+dx+(a6-dn)/2^32;da,di=N(da,dn),N(di,dw)cd,ce=da%2^31,di%2^31;da,di=cd*2^1+(di-ce)/2^31%2^1,ce*2^1+(da-cd)/2^31%2^1;p=bo[13]*2;a6=d6%2^32+db%2^32+aU[p-1]d6=a6%2^32;de=de+dj+(a6-d6)/2^32+aU[p]dq,dy=N(dy,de),N(dq,d6)a6=dk%2^32+dq%2^32;dk=a6%2^32;dt=dt+dy+(a6-dk)/2^32;db,dj=N(db,dk),N(dj,dt)cd,ce=db%2^24,dj%2^24;db,dj=(db-cd)/2^24%2^8+ce*2^8,(dj-ce)/2^24%2^8+cd*2^8;p=bo[14]*2;a6=d6%2^32+db%2^32+aU[p-1]d6=a6%2^32;de=de+dj+(a6-d6)/2^32+aU[p]dq,dy=N(dq,d6),N(dy,de)cd,ce=dq%2^16,dy%2^16;dq,dy=(dq-cd)/2^16%2^16+ce*2^16,(dy-ce)/2^16%2^16+cd*2^16;a6=dk%2^32+dq%2^32;dk=a6%2^32;dt=dt+dy+(a6-dk)/2^32;db,dj=N(db,dk),N(dj,dt)cd,ce=db%2^31,dj%2^31;db,dj=cd*2^1+(dj-ce)/2^31%2^1,ce*2^1+(db-cd)/2^31%2^1;p=bo[15]*2;a6=d7%2^32+d8%2^32+aU[p-1]d7=a6%2^32;df=df+dg+(a6-d7)/2^32+aU[p]dr,dz=N(dz,df),N(dr,d7)a6=dl%2^32+dr%2^32;dl=a6%2^32;du=du+dz+(a6-dl)/2^32;d8,dg=N(d8,dl),N(dg,du)cd,ce=d8%2^24,dg%2^24;d8,dg=(d8-cd)/2^24%2^8+ce*2^8,(dg-ce)/2^24%2^8+cd*2^8;p=bo[16]*2;a6=d7%2^32+d8%2^32+aU[p-1]d7=a6%2^32;df=df+dg+(a6-d7)/2^32+aU[p]dr,dz=N(dr,d7),N(dz,df)cd,ce=dr%2^16,dz%2^16;dr,dz=(dr-cd)/2^16%2^16+ce*2^16,(dz-ce)/2^16%2^16+cd*2^16;a6=dl%2^32+dr%2^32;dl=a6%2^32;du=du+dz+(a6-dl)/2^32;d8,dg=N(d8,dl),N(dg,du)cd,ce=d8%2^31,dg%2^31;d8,dg=cd*2^1+(dg-ce)/2^31%2^1,ce*2^1+(d8-cd)/2^31%2^1 end;cp=N(cp,d4,dk)%2^32;cq=N(cq,d5,dl)%2^32;cr=N(cr,d6,dm)%2^32;cs=N(cs,d7,dn)%2^32;ct=N(ct,d8,dp)%2^32;cu=N(cu,d9,dq)%2^32;cv=N(cv,da,dr)%2^32;cw=N(cw,db,ds)%2^32;cx=N(cx,dc,dt)%2^32;cy=N(cy,dd,du)%2^32;cz=N(cz,de,dv)%2^32;cA=N(cA,df,dw)%2^32;cB=N(cB,dg,dx)%2^32;cC=N(cC,dh,dy)%2^32;cD=N(cD,di,dz)%2^32;cE=N(cE,dj,dA)%2^32 end;c5[1],c5[2],c5[3],c5[4],c5[5],c5[6],c5[7],c5[8]=cp,cq,cr,cs,ct,cu,cv,cw;c6[1],c6[2],c6[3],c6[4],c6[5],c6[6],c6[7],c6[8]=cx,cy,cz,cA,cB,cC,cD,cE;return b8 end end;do local function dB(dC,dD,dE,dF)local G,dG,dH,dI={},0.0,0.0,1.0;for aG=1,dF do for p=l(1,aG+1-#dD),k(aG,#dC)do dG=dG+dE*dC[p]*dD[aG+1-p]end;local dJ=dG%2^24;G[aG]=i(dJ)dG=(dG-dJ)/2^24;dH=dH+dJ*dI;dI=dI*2^24 end;return G,dH end;local Y,dK,dL,o,dM,dN=0,{4,1,2,-2,2},4,{1},al,ak;repeat dL=dL+dK[dL%6]local aY=1;repeat aY=aY+dK[aY%6]if aY*aY>dL then local dO=dL^(1/3)local dP=dO*2^40;dP=dB({dP-dP%1},o,1.0,2)local H,dQ=dB(dP,dB(dP,dP,1.0,4),-1.0,4)local dR=dP[2]%65536*65536+i(dP[1]/256)local dS=dP[1]%256*16777216+i(dQ*2^-56/3*dO/dL)if Y<16 then dO=dL^(1/2)dP=dO*2^40;dP=dB({dP-dP%1},o,1.0,2)H,dQ=dB(dP,dP,-1.0,2)local dR=dP[2]%65536*65536+i(dP[1]/256)local dS=dP[1]%256*16777216+i(dQ*2^-17/dO)local Y=Y%8+1;ao[224][Y]=dS;dM[Y],dN[Y]=dR,dS+dR*aB;if Y>7 then dM,dN=aq[384],ap[384]end end;Y=Y+1;aj[Y],ai[Y]=dR,dS%aA+dR*aB;break end until dL%aY==0 until Y>79 end;for dT=224,256,32 do local c5,c6={}if au then for aG=1,8 do c5[aG]=a9(ak[aG])end else c6={}for aG=1,8 do c5[aG]=a9(ak[aG])c6[aG]=a9(al[aG])end end;ab(c5,c6,"SHA-512/"..tostring(dT).."\128"..e("\0",115).."\88",0,128)ap[dT]=c5;aq[dT]=c6 end;do local dU,dV,dW=math.sin,math.abs,math.modf;for Y=1,64 do local dR,dS=dW(dV(dU(Y))*2^16)ar[Y]=dR*65536+i(dS*2^16)end end;do local dX=29;local function dY()local W=dX%2;dX=V((dX-W)/2,142*W)return W end;for Y=1,24 do local dS,r=0;for H=1,6 do r=r and r*r*2 or 1;dS=dS+dY()*r end;local dR=dY()*r;an[Y],am[Y]=dR,dS+dR*aC end end;if K=="FFI"then aj=C.new("uint32_t[?]",#aj+1,0,unpack(aj))ai=C.new("int64_t[?]",#ai+1,0,unpack(ai))if aC==0 then am=C.new("uint32_t[?]",#am+1,0,unpack(am))an=C.new("uint32_t[?]",#an+1,0,unpack(an))else am=C.new("int64_t[?]",#am+1,0,unpack(am))end end;local dZ,d_,e0,e1;do local e2={['+']=62,['-']=62,[62]='+',['/']=63,['_']=63,[63]='/',['=']=-1,['.']=-1,[-1]='='}local e3=0;for aG,e4 in ipairs{'AZ','az','09'}do for e5=c(e4),c(e4,2)do local e6=d(e5)e2[e6]=e3;e2[e3]=e6;e3=e3+1 end end end;local e7;local function e8(e9,ea,c5,c6)local eb=ea=="s"and 16 or 32;local ec=#e9;if ec>eb then error(h("For BLAKE2%s/BLAKE2%sp/BLAKE2X%s the 'salt' parameter length must not exceed %d bytes",ea,ea,ea,eb),2)end;if c5 then local ed,ee,ef=0,ea=="s"and 4 or 8,ea=="s"and N or a9;for aG=5,4+j(ec/ee)do local eg,eh;for H=1,ee,4 do ed=ed+4;local aW,D,aX,aY=c(e9,ed-3,ed)local ei=(((aY or 0)*256+(aX or 0))*256+(D or 0))*256+(aW or 0)eg,eh=eh,ei end;c5[aG]=ef(c5[aG],eg and eh*aB+eg or eh)if c6 then c6[aG]=ef(c6[aG],eh)end end end end;local function ej(ek,el,e9,em,en,eo)em=i(em or 64)if em<1 or em>64 then error("BLAKE2b digest length must be from 1 to 64 bytes",2)end;el=el or""local ep=#el;if ep>64 then error("BLAKE2b key length must not exceed 64 bytes",2)end;e9=e9 or""local b8,eq,c5,c6=0.0,"",{unpack(ak)},not au and{unpack(al)}if eo then if c6 then c5[1]=a9(c5[1],em)c6[1]=a9(c6[1],0x40)c5[2]=a9(c5[2],eo)c6[2]=a9(c6[2],en)else c5[1]=a9(c5[1],0x40*aB+em)c5[2]=a9(c5[2],en*aB+eo)end;c5[3]=a9(c5[3],0x4000)else c5[1]=a9(c5[1],0x01010000+ep*256+em)if en then if c6 then c6[2]=a9(c6[2],en)else c5[2]=a9(c5[2],en*aB)end end end;if e9~=""then e8(e9,"b",c5,c6)end;local function er(es)if es then if eq then local b6=0;if eq~=""and#eq+#es>128 then b6=128-#eq;b8=ag(c5,c6,eq..f(es,1,b6),0,128,b8)eq=""end;local b7=#es-b6;local et=b7>0 and(b7-1)%128+1 or 0;b8=ag(c5,c6,es,b6,b7-et,b8)eq=eq..f(es,#es+1-et)return er else error("Adding more chunks is not allowed after receiving the result",2)end else if eq then if eo then ag(c5,c6,nil,0,128,0,64)else ag(c5,c6,eq..e("\0",128-#eq),0,128,b8,#eq)end;eq=nil;if en and not eo then if c6 then for aG=8,1,-1 do c5[aG*2]=c6[aG]c5[aG*2-1]=c5[aG]end;return c5,16 end else local eu=j(em/8)if c6 then for aG=1,eu do c5[aG]=U(c6[aG])..U(c5[aG])end else for aG=1,eu do c5[aG]=au(c5[aG])end end;c5=f(g(b(c5,"",1,eu),"(..)(..)(..)(..)(..)(..)(..)(..)","%8%7%6%5%4%3%2%1"),1,em*2)end;c6=nil end;return c5 end end;if ep>0 then er(el..e("\0",128-ep))end;if eo then return er()elseif ek then return er(ek)()else return er end end;local ev={blake2b_512=ej}return ev
